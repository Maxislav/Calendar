var calendarModule=angular.module("calendarModule",[]).constant("constantCalendar",{days:["П","B","C","Ч","П","С","B"],month:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]});calendarModule.directive("calendar",["$compile","$templateCache","constantCalendar","$timeout",function(a,b,c,d){function e(a,b,c){function d(a){var b="";return e==a.getTime()&&(b+="current"),f<=a.getTime()&&a.getTime()<=g&&(b+=" select"),b}for(var e=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()).getTime(),f=b.getTime(),g=c.getTime(),h=[],i=0;50>i;i++){var j=new Date(a.getFullYear(),a.getMonth(),i);j.getMonth()==a.getMonth()&&h.push({date:j,value:j.getTime(),dayWeek:j.getDay(),"class":d(j)})}for(var k=0==h[0].dayWeek?6:h[0].dayWeek-1,l=0==h[h.length-1].dayWeek?0:7-h[h.length-1].dayWeek,i=0;k>i;i++)h.unshift(null);for(var i=0;l>i;i++)h.push(null);for(var m=parseFloat((h.length/7).toFixed(0)),n=[],o=0,i=0;m>i;i++){n[i]=[];for(var j=0;7>j;j++)n[i].push(h[o]),o++}return n}return{restrict:"EA",replace:!0,templateUrl:"module/partials/calendar-label.html",scope:{before:"=before",after:"=after",link:"@link"},controller:["$scope","$element","$attrs","$timeout","$templateCache",function(a,b){function d(b){i=new Date(b.getFullYear(),b.getMonth()-1,b.getDate()),j=new Date(b.getFullYear(),b.getMonth()+1,b.getDate()),a.arrMonth=e(b,a.after,a.before),a.arrMonth.value=b.getTime(),a.arrMonthBefore=e(i,a.after,a.before),a.arrMonthBefore.value=i.getTime(),a.arrMonthAfter=e(j,a.after,a.before),a.arrMonthAfter.value=j.getTime()}function f(c){var d=!1;angular.forEach(a.calendarElement.find("*"),function(a){return angular.equals(angular.element(a),angular.element(c.target))?void(d=!0):void 0}),d||angular.forEach(b.find("*"),function(a){return angular.equals(angular.element(a),angular.element(c.target))?void(d=!0):void 0}),d||(a.show=!1,a.$apply())}function g(){window.document.removeEventListener("click",f)}var h="true"==a.link?!0:!1;a.show=!1,a.constantCalendar=c,a.beforeLabelValue=a.before,a.afterLabelValue=a.after;var i,j,k=new Date(a.after.getTime()+(a.before.getTime()-a.after.getTime())/2);a.includeMonths="module/partials/container-months.html",d(k),a.stepBack=function(){var a=new Date(k.getFullYear(),k.getMonth()-1,k.getDate());k=a,d(a)},a.stepForward=function(){var a=new Date(k.getFullYear(),k.getMonth()+1,k.getDate());k=a,d(a)},a.selectEvent=function(b){a.before.getTime()<b.value?a.before=new Date(b.value):b.value<a.after.getTime()?a.after=new Date(b.value):(a.after=new Date(b.value),a.before=new Date(b.value)),h&&(a.beforeLabelValue=a.before,a.afterLabelValue=a.after)},a.apply=function(){a.beforeLabelValue=a.before,a.afterLabelValue=a.after,a.click()},a.$watch("before",function(){d(k)}),a.$watch("after",function(){d(k)}),a.$watch("show",function(a){a?window.document.addEventListener("click",f):window.document.removeEventListener("click",f)}),a.$on("$destroy",function(){console.log("destroy"),g()})}],link:function(c){function e(){var e=a(b.get("module/partials/calendar-view.html"));f=e(c),f.css("display","none");var g=angular.element(document.body);g.append(f),c.calendarElement=f,d(function(){c.show=!0,f.css("display","inherit")},1)}var f=null;c.show=!1,c.click=function(){return f?(c.show=!c.show,void console.log(c.show)):void e()}}}}]),calendarModule.directive("daysweek",["$compile","constantCalendar",function(a,b){return{restrict:"E",replace:!0,scope:{},templateUrl:"module/partials/calendar-days.html",controller:["$scope",function(a){a.constantCalendar=b}]}}]),angular.module("calendarModule").run(["$templateCache",function(a){"use strict";a.put("module/partials/calendar-days.html",'<div class="row days"><div class="col-day text-right" ng-repeat="days in constantCalendar.days track by $index"><span ng-switch="$index"><span ng-switch-when="6" class="red">{{days}}</span> <span ng-switch-when="5" class="red">{{days}}</span> <span ng-switch-default>{{days}}</span></span></div></div>'),a.put("module/partials/calendar-label.html",'<div class="calendar-label"><div class="calendar-label-ico" ng-click="click()"><div class="ico-calendar">&nbsp;</div></div><div class="calendar-label-btn" ng-class="show && \'open\'">{{after | date:\'dd MMM\'}} - {{beforeLabelValue | date:\'dd MMM\'}} {{before | date:\'yyyy\'}}</div></div>'),a.put("module/partials/calendar-view.html",'<div ng-show="show" class="calendar-view"><div class="container-months"><div ng-include="includeMonths"></div></div><div class="info-block"><div class="info-label"><div class=""><div class="info-label-value">{{ after | date:\'yyyy.MM.dd\' }}</div></div><div><div class="info-label-value">{{ before | date:\'yyyy.MM.dd\' }}</div></div><div><div class="button" ng-click="apply()">Сегодня</div></div></div></div></div>'),a.put("module/partials/container-months.html",'<table><tr><td><!--текущий--><div class="block-month"><daysweek></daysweek><div class="border-line"><div class="btn-back" ng-click="stepBack()">&#8249;</div><div class="btn-forward" ng-click="stepForward()">&#8250;</div></div><div class="row name-month">{{arrMonth.value | date:\'MMMM yyyy\'}}</div><div class="numeric"><div class="row" ng-repeat="week in arrMonth track by $index"><div class="col-day text-right {{day.class}}" ng-repeat="day in arrMonth[$index] track by $index" ng-click="selectEvent(day)"><span ng-switch="$index"><span ng-switch-when="6" class="red">{{day.value | date:\'d\'}}</span> <span ng-switch-when="5" class="red">{{day.value | date:\'d\'}}</span> <span ng-switch-default>{{day.value | date:\'d\'}}</span></span></div></div></div></div></td></tr></table>')}]);