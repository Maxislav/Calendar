var calendarModule=angular.module("calendarModule",[]).constant("constantCalendar",{days:["П","B","C","Ч","П","С","B"],month:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]});calendarModule.directive("calendar",["$compile","$templateCache","constantCalendar","$timeout","factoryOffset",function(a,b,c,d,e){function f(a,b,c){function d(a){var b="";return e==a.getTime()&&(b+="current"),f<=a.getTime()&&a.getTime()<=g&&(b+=" select"),b}for(var e=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()).getTime(),f=b.getTime(),g=c.getTime(),h=[],i=0;50>i;i++){var j=new Date(a.getFullYear(),a.getMonth(),i);j.getMonth()==a.getMonth()&&h.push({date:j,value:j.getTime(),dayWeek:j.getDay(),"class":d(j)})}for(var k=0==h[0].dayWeek?6:h[0].dayWeek-1,l=0==h[h.length-1].dayWeek?0:7-h[h.length-1].dayWeek,i=0;k>i;i++)h.unshift(null);for(var i=0;l>i;i++)h.push(null);for(var m=parseFloat((h.length/7).toFixed(0)),n=[],o=0,i=0;m>i;i++){n[i]=[];for(var j=0;7>j;j++)n[i].push(h[o]),o++}return n}return{restrict:"EA",replace:!0,templateUrl:"module/partials/calendar-label.html",scope:{before:"=before",after:"=after",link:"@link"},controller:["$scope","$element","$attrs","$timeout","$templateCache",function(a,b){function d(b){h=new Date(b.getFullYear(),b.getMonth()-1,b.getDate()),i=new Date(b.getFullYear(),b.getMonth()+1,b.getDate()),a.months[0]={formatMonth:f(h,a.after,a.before),value:h.getTime(),btn:"module/partials/btn-back.html"},a.months[1]={formatMonth:f(b,a.after,a.before),value:b.getTime(),btn:null},a.months[2]={formatMonth:f(i,a.after,a.before),value:i.getTime(),btn:"module/partials/btn-forward.html"}}function e(c){var d=!1;angular.forEach(a.content.find("*"),function(a){return angular.equals(angular.element(a),angular.element(c.target))?void(d=!0):void 0}),d||angular.forEach(b.find("*"),function(a){return angular.equals(angular.element(a),angular.element(c.target))?void(d=!0):void 0}),d||(a.show=!1,a.$apply())}function g(){window.document.removeEventListener("click",e)}"true"==a.link?!0:!1;a.show=!1,a.constantCalendar=c,a.months=[],a.beforeLabelValue=a.before,a.afterLabelValue=a.after;var h,i,j=new Date(a.after.getTime()+(a.before.getTime()-a.after.getTime())/2);a.includeMonths="module/partials/container-months.html",d(j),a.stepBack=function(){var a=new Date(j.getFullYear(),j.getMonth()-1,j.getDate());j=a,d(a)},a.stepForward=function(){var a=new Date(j.getFullYear(),j.getMonth()+1,j.getDate());j=a,d(a)},a.selectEvent=function(b){a.before.getTime()<b.value?a.before=new Date(b.value):b.value<a.after.getTime()?a.after=new Date(b.value):(a.after=new Date(b.value),a.before=new Date(b.value))},a.apply=function(){a.click()},a.$watch("before",function(){d(j)}),a.$watch("after",function(){d(j)}),a.$watch("show",function(a){a?window.document.addEventListener("click",e):window.document.removeEventListener("click",e)}),a.$on("$destroy",function(){console.log("destroy"),g()})}],link:function(c,f){function g(){var g=a(b.get("module/partials/calendar-view.html"));c.content=h=g(c),h.css("display","none"),angular.element(document.body).append(h);var i,j;i=e.getOffset(f[0]).left+f.prop("offsetWidth")/2,j=e.getOffset(f[0]).top+f.prop("offsetHeight"),c.content.css("left",i+"px"),c.content.css("top",j+"px"),d(function(){c.show=!0,h.css("display","inherit")},1)}var h=null;c.show=!1,c.content,c.click=function(){return h?void(c.show=!c.show):void g()}}}}]),calendarModule.directive("daysweek",["$compile","constantCalendar",function(a,b){return{restrict:"E",replace:!0,scope:{},templateUrl:"module/partials/calendar-days.html",controller:["$scope",function(a){a.constantCalendar=b}]}}]),angular.module("calendarModule").factory("factoryOffset",function(){function a(a){return a.getBoundingClientRect?c(a):b(a)}function b(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}function c(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}return{getOffset:a}}),angular.module("calendarModule").run(["$templateCache",function(a){"use strict";a.put("module/partials/btn-back.html",'<div class="btn-back" ng-click="stepBack()">&#8249;</div>'),a.put("module/partials/btn-forward.html",'<div class="btn-forward" ng-click="stepForward()">&#8250;</div>'),a.put("module/partials/calendar-days.html",'<div class="row days"><div class="col-day text-right" ng-repeat="days in constantCalendar.days track by $index"><span ng-switch="$index"><span ng-switch-when="6" class="red">{{days}}</span> <span ng-switch-when="5" class="red">{{days}}</span> <span ng-switch-default>{{days}}</span></span></div></div>'),a.put("module/partials/calendar-label.html",'<div class="calendar-label"><div class="calendar-label-btn" ng-class="show && \'open\'">{{after | date:\'dd MMM\'}} - {{before | date:\'dd MMM\'}} {{before | date:\'yyyy\'}}</div><div class="calendar-label-ico" ng-click="click()"><div class="ico-calendar">&nbsp;</div></div></div>'),a.put("module/partials/calendar-view.html",'<div ng-show="show" class="calendar-view"><div class="container-months"><div ng-include="includeMonths"></div></div><div class="info-block"><div class="row info-label"><div class="col-4"><div class="info-label-value">{{ after | date:\'yyyy.MM.dd\' }}</div></div><div class="col-4"><div class="info-label-value">{{ before | date:\'yyyy.MM.dd\' }}</div></div><div class="col-4"><div class="button" ng-click="apply()">Применить</div></div></div></div></div>'),a.put("module/partials/container-months.html",'<table><tr><td ng-repeat="month in months track by $index"><div class="block-month"><daysweek></daysweek><div class="border-line" ng-include="month.btn"></div><div class="row name-month">{{month.value | date:\'MMMM yyyy\'}}</div><div class="numeric"><div class="row" ng-repeat="week in month.formatMonth track by $index"><div class="col-day text-right {{day.class}}" ng-repeat="day in month.formatMonth[$index] track by $index" ng-click="selectEvent(day)"><span ng-switch="$index"><span ng-switch-when="6" class="red">{{day.value | date:\'d\'}}</span> <span ng-switch-when="5" class="red">{{day.value | date:\'d\'}}</span> <span ng-switch-default>{{day.value | date:\'d\'}}</span></span></div></div></div></div></td></tr></table>')}]);